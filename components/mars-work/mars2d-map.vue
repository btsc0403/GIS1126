<template>
  <div class="map-container">
    <div class="component-header">
      <div class="arrow"></div>
      <span>Map</span>
    </div>
    <div :id="withKeyId" class="mars2d-container"></div>
  </div>

    <div class="side-panel">
    <div class="component-header">
      <div class="arrow"></div>
      <span>Statistics</span>
    </div>
    <div>
      <div ref="pieChartContainer" class="chart-container"></div>
    
    
    <div class="coordinate-list" v-if="selectedCategoryIndex !== null">
      <ul>
        <li v-for="(coord, subIndex) in coordinates[selectedCategoryIndex].items" :key="subIndex">
          <img :src="getIconUrlByLabel(coordinates[selectedCategoryIndex].label)" alt="icon" class="label-icon" />
          <strong @click="flyTo(coord, subIndex)">{{ coord.label }}</strong>
        </li>
      </ul>
    </div>
  </div>

    <!-- 
    <div class="coordinate-list">
      <ul>
        <li v-for="(category, index) in coordinates" :key="index">
          <img :src="getIconUrlByLabel(category.label)" alt="icon" class="label-icon" />
          <strong @click="toggleCategory(index)">{{ category.label }}</strong>
          <ul v-if="category.visible">
            <li 
              v-for="(coord, subIndex) in category.items" 
              :key="subIndex"
              @click="flyTo(coord, subIndex)"
            >
              {{ coord.label }}: [{{ coord.lat }}, {{ coord.lng }}]
            </li> 
          </ul>
        </li>
      </ul>
    </div>
      -->
      

    <div class="gpt4-chatbox">
      <div class="component-header">
        <div class="arrow"></div>
        <span>Q&A</span>
      </div>
      <div class="chat-content">
        <p v-for="(msg, index) in chatMessages" :key="index" :class="msg.startsWith('用户:') ? 'user-message' : ''">
          {{ msg }}
        </p>
      </div>
      <div class="input-container"> 
        <textarea v-model="userInput" placeholder="Type here"></textarea>
        <button @click="sendMessage">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-send">
            <line x1="22" y1="2" x2="11" y2="13"></line>
            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <div class="description-container">
    <div class="component-header">
      <div class="arrow"></div>
      <span>Details</span>
    </div>
    <div v-if="selectedBuilding">
      <h2 class="oldfont">{{ selectedBuilding?.label }}</h2>
      <div class="building-category">
 
        <img :src="getIconUrlByLabel(findBuildingCategory(selectedBuilding, coordinates))" alt="icon" class="label-icon" />
        <span>{{ findBuildingCategory(selectedBuilding, coordinates) }}</span>
      </div>
      <p class="description-box">Description: {{ selectedBuildingDescription }}</p>
    </div>
    
    <div v-else>
      <p>Please select a building for more details.</p>
    </div>
      <!-- 图片展示区域 -->
      <div class="image-display" v-if="selectedBuildingImage">
        <img :src="selectedBuildingImage" @error="onImageError" alt="Building Image" class="building-image" />
      </div>
    </div>
      
</template>

<script setup lang="ts">
import { ref, computed, onBeforeUnmount, onMounted } from "vue"
import * as L from "leaflet"
import * as mars2d from "mars2d"
import * as echarts from "echarts" // 引入 ECharts

const pieChartContainer = ref(null) // 引用 DOM 容器
const selectedCategoryIndex = ref(null) // 用于跟踪选中的类别索引
const selectedBuildingImage = ref("")
// 处理图片加载失败的逻辑
const onImageError = () => {
  selectedBuildingImage.value = "" // 清空图片路径
}

const props = withDefaults(
  defineProps<{
    url: string
    mapKey?: string
    options?: any
  }>(),
  {
    url: "",
    mapKey: "default",
    options: () => ({})
  }
)

let map: mars2d.Map
const withKeyId = computed(() => `mars2d-container-${props.mapKey}`)
const selectedBuilding = ref<{ label: string; lat: number; lng: number } | null>(null)
const selectedBuildingDescription = ref<string | null>(null)
const showDetailModal = ref(false)
const coordinates = ref([
  {
    label: "Commercial Buildings",
    visible: false,
    items: [
      { label: "中国出口商品交易会流花路旧址", lat: 23.14296, lng: 113.257971 },
{ label: "太如茶楼旧址", lat: 23.11357, lng: 113.252397 },
{ label: "光复中路当楼旧址", lat: 23.117014, lng: 113.251563 },
{ label: "添男茶楼旧址", lat: 23.112217, lng: 113.25058 },
{ label: "生隆昌老号旧址", lat: 23.112398, lng: 113.252478 },
{ label: "大同酒家", lat: 23.108482, lng: 113.254793 },
{ label: "山庄旅舍", lat: 23.19637, lng: 113.308289 },
{ label: "白云宾馆", lat: 23.13774, lng: 113.286536 },
{ label: "花园酒店", lat: 23.135124, lng: 113.286216 },
{ label: "流花宾馆北楼", lat: 23.146517, lng: 113.25632 },
{ label: "流花宾馆南楼", lat: 23.146163, lng: 113.256218 },
{ label: "广东迎宾馆碧海楼", lat: 23.129634, lng: 113.261167 },
{ label: "广东迎宾馆净慧楼", lat: 23.128486, lng: 113.261321 },
{ label: "广东迎宾馆六榕楼", lat: 23.12842, lng: 113.259972 },
{ label: "羊城宾馆旧址", lat: 23.13932, lng: 113.258599 },
{ label: "东方宾馆西楼", lat: 23.13932, lng: 113.258599 },
{ label: "中国大酒店", lat: 23.139938, lng: 113.26044 },
{ label: "广州宾馆", lat: 23.115912, lng: 113.265621 },
{ label: "矿泉别墅旧址", lat: 23.163054, lng: 113.253873 },
{ label: "北平旅店旧址", lat: 23.109118, lng: 113.255599 },
{ label: "新爱群大厦", lat: 23.109473, lng: 113.257038 },
{ label: "大新路276号骑楼", lat: 23.115898, lng: 113.257911 },
{ label: "大新路278号骑楼", lat: 23.115848, lng: 113.25779 },
{ label: "大新路407、409号骑楼", lat: 23.114977, lng: 113.254457 },
{ label: "广九四马路21、23号骑楼", lat: 23.118319, lng: 113.281711 },
{ label: "惠福西路106号骑楼", lat: 23.120325, lng: 113.256645 },
{ label: "人民南路140号骑楼", lat: 23.113198, lng: 113.253512 },
{ label: "文德路53、55、57、59号骑楼", lat: 23.121945, lng: 113.272065 },
{ label: "沿江西路55、57号骑楼", lat: 23.108053, lng: 113.253627 },
{ label: "大新路341号骑楼", lat: 23.115297, lng: 113.255883 },
{ label: "大新路343号骑楼", lat: 23.115315, lng: 113.255891 },
{ label: "大新路349号骑楼", lat: 23.115298, lng: 113.255787 },
{ label: "海珠南路152、152-1、152-2、152-3号骑楼", lat: 23.114148, lng: 113.2568 },
{ label: "海珠中路113号骑楼", lat: 23.120148, lng: 113.256261 },
{ label: "南华西路77、79号骑楼", lat: 23.10532, lng: 113.254022 },
{ label: "中国福安保险公司广州分公司旧址", lat: 23.111653, lng: 113.251956 },
{ label: "位元堂旧址", lat: 23.112392, lng: 113.252413 },
{ label: "位元堂栈房旧址", lat: 23.112358, lng: 113.252223 },
{ label: "黄耀南老药行旧址", lat: 23.111987, lng: 113.251205 },
{ label: "下九路天喜堂旧址", lat: 23.113858, lng: 113.246794 },
{ label: "大新路107号骑楼", lat: 23.116384, lng: 113.26171 },
{ label: "大新路73、75号骑楼", lat: 23.1165, lng: 113.262444 },
{ label: "一德路173、175、177、179、181号骑楼", lat: 23.113791, lng: 113.261841 },
{ label: "安亚药行旧址", lat: 23.112365, lng: 113.255149 },
{ label: "香港中国康年人寿保险公司旧址", lat: 23.112338, lng: 113.255085 },
{ label: "东里大街商铺旧址", lat: 22.827282, lng: 113.507313 },
{ label: "北京路370号骑楼", lat: 23.127101, lng: 113.268972 },
{ label: "西湖路80号骑楼", lat: 23.123095, lng: 113.26529 },
{ label: "西湖路82号骑楼", lat: 23.123047, lng: 113.265188 },
{ label: "恩宁路46~54号（双号）骑楼", lat: 23.115284, lng: 113.236596 },
{ label: "恩宁路140号骑楼", lat: 23.114053, lng: 113.238542 },
{ label: "恩宁路255、257号骑楼", lat: 23.11351, lng: 113.241028 },
{ label: "陈永记旧址", lat: 23.116908, lng: 113.249031 },
{ label: "皇上皇腊味店", lat: 23.11385, lng: 113.246152 },
{ label: "蛇王福旧址", lat: 23.111788, lng: 113.252757 },
{ label: "黄河洋行旧址", lat: 23.111829, lng: 113.251524 },
{ label: "黄祥华如意油广州总店旧址", lat: 23.112281, lng: 113.251966 },
{ label: "天泉银号旧址", lat: 23.112771, lng: 113.251959 },
{ label: "西荣巷32号后货楼旧址", lat: 23.11382, lng: 113.252047 },
{ label: "道亨银号货楼旧址", lat: 23.112257, lng: 113.252526 },
{ label: "人民南路185号骑楼", lat: 23.114416, lng: 113.252703 },
{ label: "人民南路33号骑楼", lat: 23.109899, lng: 113.253661 },
{ label: "人民南路35号骑楼", lat: 23.109857, lng: 113.253786 },
{ label: "人民南路37号骑楼", lat: 23.109832, lng: 113.253821 },
{ label: "人民南路7号骑楼", lat: 23.108865, lng: 113.253795 },
{ label: "荣珍酒楼旧址", lat: 23.115268, lng: 113.249843 },
{ label: "上九路72号骑楼", lat: 23.115531, lng: 113.25101 },
{ label: "富国茶楼旧址", lat: 23.110626, lng: 113.246118 }
    ]
  },
  {
    label: "Industrial Buildings",
    visible: false,
    items: [
      { label: "诚志堂货仓旧址", lat: 23.095412, lng: 113.250524 },
{ label: "东亚烟厂旧址", lat: 23.104509, lng: 113.251771 },
{ label: "西村电厂输送桥", lat: 23.138854, lng: 113.232305 },
{ label: "天成路96、98号广彩加工场旧址", lat: 23.114381, lng: 113.255557 },
{ label: "粤汉铁路黄沙车站旧址", lat: 22.989125, lng: 113.277732 },
{ label: "华侨糖厂旧址（拱形仓库）", lat: 23.153181, lng: 113.219818 },
{ label: "广州铁路局援外仓建筑群旧址（1号仓）", lat: 23.142746, lng: 113.374574 },
{ label: "广州铁路局援外仓建筑群旧址（9号仓）", lat: 23.142746, lng: 113.374574 },
{ label: "广州铁路局援外仓建筑群旧址（办公楼）", lat: 23.142746, lng: 113.374574 },
{ label: "广州造纸厂旧址大烟囱", lat: 23.073896, lng: 113.267857 },
{ label: "广州造纸厂旧址码头高层仓", lat: 23.073896, lng: 113.267857 },
{ label: "广州造纸厂旧址水塘及驳岸", lat: 23.073896, lng: 113.267857 },
{ label: "广州造纸厂旧址新浊水泵房", lat: 23.073896, lng: 113.267857 },
{ label: "广州造纸厂旧址1号煤仓", lat: 23.073896, lng: 113.267857 },
{ label: "广州造纸厂旧址2号煤仓", lat: 23.073896, lng: 113.267857 },
{ label: "广东省石油公司昌岗路油库", lat: 23.080911, lng: 113.258283 },
{ label: "第一棉纺厂旧址1号车间", lat: 23.081381, lng: 113.26426 },
{ label: "录顺船坞", lat: 23.259036, lng: 113.532165 },
{ label: "张安昌中药厂旧址", lat: 23.112236, lng: 113.251461 },
{ label: "广州市第二棉纺厂旧址（部分车间）", lat: 23.118862, lng: 113.354943 },
{ label: "广州啤酒厂麦仓旧址", lat: 23.145427, lng: 113.236568 },
{ label: "广东罐头厂冷库旧址", lat: 23.110456, lng: 113.370737 },
{ label: "广东罐头厂包装仓库及站台旧址", lat: 23.110456, lng: 113.370737 },
{ label: "增城糖纸厂蒸煮车间旧址", lat: 23.299662, lng: 113.843509 },
{ label: "大干围仓库旧址", lat: 23.061392, lng: 113.316089 },
{ label: "城安围船厂旧址（第13号、14号、15号、16号车间、下水滑道）", lat: 23.054588, lng: 113.299097 },
{ label: "广州纺织机械厂旧址（装配车间、木模车间、布配和机械车间、机装车间、铆杆开料车间、退火炉）", lat: 23.098818, lng: 113.324615 },
{ label: "广摩集团五羊钢管厂旧址（4号车间）", lat: 23.28153, lng: 113.244476 },
{ label: "广州纤维板厂旧址（水塔、纤维板车间、锅炉房、起木码头）", lat: 23.244831, lng: 113.218168 },
{ label: "广东省粮油储运公司第二仓库（10、16、18、22、26号仓库）", lat: 23.039813, lng: 113.417109 },
{ label: "黄埔老港（钢板桩码头、6号仓）", lat: 23.093402, lng: 113.450125 },
{ label: "文冲船厂（1号船坞、2号船坞）", lat: 23.090354, lng: 113.473726 },
{ label: "大濠洲西后导标塔", lat: 23.092354, lng: 113.459679 },
{ label: "鱼珠船厂旧址（港池船排、候工房）", lat: 23.09605, lng: 113.433396 }
    ]
  },
  {
    label: "Military Buildings",
    visible: false,
    items: [
      { label: "民国广东警备司令部旧址", lat: 23.13023, lng: 113.267167 },
{ label: "沙湾镇北村民兵营部旧址", lat: 22.903745, lng: 113.334401 },
{ label: "粤赣湘边纵队东江第三支队六团增城人民常备第二大队部旧址", lat: 23.286264, lng: 113.838653 },
{ label: "上塘村炮楼", lat: 23.149988, lng: 113.832437 },
{ label: "石迳村炮楼", lat: 23.236995, lng: 113.679568 },
{ label: "民乐村炮楼", lat: 23.546277, lng: 113.585226 },
{ label: "五丰村鲇鱼塘", lat: 23.546277, lng: 113.585226 },
{ label: "石岭村碉楼", lat: 23.703706, lng: 113.657611 },
{ label: "民国广东警备司令部旧址", lat: 23.130231, lng: 113.267167 }
    ]
  },
  {
    label: "Public Buildings",
    visible: false,
    items: [
      { label: "华南土特产展览交流大会旧址水产馆", lat: 23.109669, lng: 113.251401 },
{ label: "华南土特产展览交流大会旧址省际馆", lat: 23.109669, lng: 113.251401 },
{ label: "华南土特产展览交流大会旧址手工业馆", lat: 23.109669, lng: 113.251401 },
{ label: "华南土特产展览交流大会旧址水果蔬菜馆", lat: 23.109669, lng: 113.251401 },
{ label: "华南土特产展览交流大会旧址门楼", lat: 23.109669, lng: 113.251401 },
{ label: "西汉南越王博物馆建筑群", lat: 23.138452, lng: 113.261319 },
{ label: "广东科学馆大楼", lat: 23.13284, lng: 113.262844 },
{ label: "广州中苏友好大厦旧址", lat: 23.14296, lng: 113.257971 },
{ label: "友谊剧院", lat: 23.145134, lng: 113.257519 },
{ label: "广东省农业展览馆旧址", lat: 23.138707, lng: 113.299932 },
{ label: "广州美术学院主楼", lat: 23.093278, lng: 113.279114 },
{ label: "救亡日报社南迁广州旧址", lat: 23.118259, lng: 113.250973 },
{ label: "明心书院建筑群旧址之一", lat: 23.101101, lng: 113.238494 },
{ label: "明心书院建筑群旧址之二", lat: 23.098814, lng: 113.238938 },
{ label: "明心书院建筑群旧址之三", lat: 23.099766, lng: 113.239608 },
{ label: "明心书院建筑群旧址之四", lat: 23.098711, lng: 113.238746 },
{ label: "明心书院建筑群旧址之五", lat: 23.098711, lng: 113.238746 },
{ label: "广州市第二中学教学楼旧址 （一中楼）", lat: 23.113169, lng: 113.23467 },
{ label: "华南工学院办公大楼旧址", lat: 23.150129, lng: 113.347859 },
{ label: "华南工学院化工实验室大楼旧址", lat: 23.150129, lng: 113.347859 },
{ label: "华南工学院化工系楼旧址", lat: 23.150129, lng: 113.347859 },
{ label: "华南工学院数学电讯楼旧址", lat: 23.150129, lng: 113.347859 },
{ label: "华南工学院图书馆旧址", lat: 23.152082, lng: 113.345982 },
{ label: "华南工学院物理楼旧址", lat: 23.150129, lng: 113.347859 },
{ label: "华南工学院综合教学楼旧址", lat: 23.150129, lng: 113.347859 },
{ label: "广州市总工会办公楼", lat: 23.131369, lng: 113.260653 },
{ label: "广州市总工会礼堂", lat: 23.131369, lng: 113.260653 },
{ label: "广东国民大学第二校舍旧址", lat: 23.12025, lng: 113.257865 },
{ label: "教育路何氏书院旧址", lat: 23.123822, lng: 113.265643 },
{ label: "考亭书院旧址", lat: 23.124469, lng: 113.266414 },
{ label: "法国天主教会东山安老院旧址", lat: 23.128282, lng: 113.305099 },
{ label: "广州大中中学旧址", lat: 23.136451, lng: 113.273706 },
{ label: "见大书院旧址", lat: 23.124901, lng: 113.266858 },
{ label: "广东妇女解放协会旧址", lat: 23.121496, lng: 113.277685 },
{ label: "中山医学院药理寄生虫楼旧址", lat: 23.129506, lng: 113.289218 },
{ label: "中西医院旧址", lat: 23.108252, lng: 113.26361 },
{ label: "伍家祠道教会医院旧址", lat: 23.1038, lng: 113.257098 },
{ label: "两广浸信会医院附属建筑旧址", lat: 23.121925, lng: 113.293612 },
{ label: "达保罗医院旧址", lat: 23.119646, lng: 113.253181 },
{ label: "奇和堂药局旧址", lat: 23.11211, lng: 113.247439 },
{ label: "明珠影画院旧址", lat: 23.111697, lng: 113.260891 },
{ label: "广东国际大厦", lat: 23.138617, lng: 113.282611 },
{ label: "趣园红楼旧址", lat: 23.092528, lng: 113.252207 },
{ label: "民国广州第十一区警署警察宿舍旧址", lat: 23.102172, lng: 113.269735 },
{ label: "华南工学院南一宿舍1~6号旧址", lat: 23.152082, lng: 113.345982 },
{ label: "先施公司附属建筑群旧址", lat: 23.111725, lng: 113.25826 },
{ label: "智兴街明园", lat: 23.128807, lng: 113.280749 },
{ label: "慎园", lat: 23.119168, lng: 113.296978 },
{ label: "平正纪念楼", lat: 23.123333, lng: 113.294546 },
{ label: "进园", lat: 23.122265, lng: 113.299434 },
{ label: "华南植物园水榭", lat: 23.186873, lng: 113.367191 },
{ label: "兰圃", lat: 23.142594, lng: 113.259982 },
{ label: "著义小学校旧址（门楼）", lat: 23.296653, lng: 113.26835 },
{ label: "五龙岗村学校旧址（门楼）", lat: 23.244256, lng: 113.283213 },
{ label: "枧村渤海里门楼", lat: 23.546277, lng: 113.585226 },
{ label: "枧村仁厚里门楼", lat: 23.546277, lng: 113.585226 },
{ label: "温泉镇乌石村大围队门楼", lat: 23.853954, lng: 113.809549 },
{ label: "北亭村“路接青云”街门", lat: 23.047938, lng: 113.374915 },
{ label: "大岭村龙津街街门", lat: 22.985158, lng: 113.477564 },
{ label: "大岭村龙荫坊坊门", lat: 22.985158, lng: 113.477564 },
{ label: "大岭村耀德里坊门", lat: 22.985158, lng: 113.477564 },
{ label: "大岭村颖源里坊门", lat: 22.985158, lng: 113.477564 },
{ label: "大岭村“沙井气”古井", lat: 22.985158, lng: 113.477564 },
{ label: "大岭村大巷巷门", lat: 22.985158, lng: 113.477564 },
{ label: "穗石村“长林厚道”村门", lat: 23.050558, lng: 113.414741 },
{ label: "穗石村双桂坊门楼", lat: 23.046805, lng: 113.410209 },
{ label: "广东省荣军医院旧址（观鱼亭和碧漪亭）", lat: 23.088857, lng: 113.396211 },
{ label: "茅岗村塘口门楼", lat: 23.110261, lng: 113.433913 },
{ label: "时敏桥", lat: 23.116897, lng: 113.235328 },
{ label: "芳村儿童托养院旧址", lat: 23.098121, lng: 113.243251 },
{ label: "明心书院建筑群旧址之六", lat: 23.098711, lng: 113.238746 },
{ label: "西华路彩虹桥", lat: 23.132227, lng: 113.246943 },
{ label: "佛塱上南客家围屋", lat: 23.369851, lng: 113.532146 },
{ label: "小虎岛人民公社礼堂旧址", lat: 22.843267, lng: 113.532923 },
{ label: "暨南大学办公楼旧址", lat: 23.130324, lng: 113.348478 },
{ label: "华南农业大学亚太地区蚕桑培训中心", lat: 23.159671, lng: 113.351813 },
{ label: "流花湖公园南门", lat: 23.137227, lng: 113.249368 },
{ label: "流花湖公园红桥及葵堤", lat: 23.137227, lng: 113.249368 },
{ label: "东湖公园九曲桥", lat: 23.115193, lng: 113.292052 },
{ label: "东湖公园船闸", lat: 23.115193, lng: 113.292052 },
{ label: "东湖公园西门", lat: 23.115193, lng: 113.292052 },
{ label: "粤汉铁路流溪河大桥", lat: 23.267578, lng: 113.230052 },
{ label: "城郊村逸亭书舍", lat: 23.546277, lng: 113.585226 },
{ label: "高田村平山围门楼", lat: 23.546277, lng: 113.585226 },
{ label: "沙湾镇正园", lat: 22.905865, lng: 113.335966 },
{ label: "沙湾镇沙坑会场", lat: 22.913202, lng: 113.344254 },
{ label: "沙湾镇公局巷孖井", lat: 22.903715, lng: 113.336322 },
{ label: "沙湾镇安宁西街大中堂", lat: 22.902987, lng: 113.335811 },
{ label: "沙湾镇三槐里社稷坛", lat: 22.907173, lng: 113.335969 },
{ label: "沙湾镇何氏福荫堂", lat: 22.902152, lng: 113.33609 },
{ label: "广州美术学院附属中等美术学校南楼", lat: 23.092635, lng: 113.278528 },
{ label: "朗头村近光里巷口书室", lat: 23.352072, lng: 113.075299 },
{ label: "敬思堂", lat: 23.07386, lng: 113.409209 },
{ label: "广州华侨学生补习学校石牌旧址", lat: 23.130324, lng: 113.348478 },
{ label: "中华人民共和国广州华侨学生接待站", lat: 23.151673, lng: 113.331995 },
{ label: "华南农学院7号楼", lat: 23.158908, lng: 113.356424 },
{ label: "华南农学院11号楼", lat: 23.158908, lng: 113.356424 },
{ label: "同安南约门楼", lat: 22.625484, lng: 110.144045 },
{ label: "流花西苑", lat: 23.137227, lng: 113.249368 },
{ label: "广九铁路俱乐部旧址", lat: 23.124396, lng: 113.29853 },
{ label: "梧岗书舍", lat: 23.279395, lng: 113.235404 },
{ label: "泰昌书舍", lat: 23.349783, lng: 113.174852 },
{ label: "德寿里门楼", lat: 23.198038, lng: 113.264467 },
{ label: "丁联社旧址", lat: 23.346792, lng: 113.28584 },
{ label: "沛泽源流门楼", lat: 23.350189, lng: 113.315911 },
{ label: "滘心南堤水闸与滘心乡堤基宪示碑", lat: 23.221884, lng: 113.257489 },
{ label: "月峯书舍", lat: 23.296115, lng: 113.304052 },
{ label: "丽翁书舍", lat: 23.296115, lng: 113.304052 },
{ label: "建阳书舍", lat: 23.296009, lng: 113.305591 },
{ label: "南沙牌坊", lat: 22.80136, lng: 113.533521 },
{ label: "小龙村长巷门楼", lat: 23.017199, lng: 113.395338 },
{ label: "小龙村乡约", lat: 22.961639, lng: 113.435803 },
{ label: "岳溪小学旧址", lat: 22.985285, lng: 113.470347 },
{ label: "先锋四巷门楼", lat: 22.942502, lng: 113.362892 },
{ label: "永汉电影院", lat: 23.12129, lng: 113.26928 },
{ label: "竺园", lat: 23.118486, lng: 113.296568 },
{ label: "培正小学善正楼", lat: 23.119371, lng: 113.287832 },
{ label: "华英医院旧址", lat: 23.131114, lng: 113.286258 },
{ label: "广东大埔同乡会旧址", lat: 23.120796, lng: 113.271993 },
{ label: "坑口村乡约", lat: 23.075889, lng: 113.237214 },
{ label: "《群声报》报馆旧址", lat: 23.116907, lng: 113.251795 },
{ label: "《宏道日报》报社旧址", lat: 23.117185, lng: 113.251776 },
{ label: "民声日报社旧址", lat: 23.117625, lng: 113.251728 },
{ label: "乐干楼", lat: 23.106028, lng: 113.281487 },
{ label: "岭南画派纪念馆", lat: 23.092635, lng: 113.278528 },
{ label: "马应彪夫人护养院副楼", lat: 23.096091, lng: 113.296798 },
{ label: "广州市美术有限公司画棚旧址", lat: 23.147279, lng: 113.310079 },
{ label: "暨南大学化学楼", lat: 23.130535, lng: 113.348576 },
{ label: "东郊公园湖心亭", lat: 23.126824, lng: 113.365284 },
{ label: "东郊公园双层亭", lat: 23.126824, lng: 113.365284 },
{ label: "华南农学院8号楼", lat: 23.158908, lng: 113.356424 },
{ label: "华南植物园草坪办公楼", lat: 23.183036, lng: 113.366548 },
{ label: "蒲岗桥", lat: 23.183036, lng: 113.366548 },
{ label: "棕榈休息亭", lat: 23.183036, lng: 113.366548 },
{ label: "高滩村“送瘟神”纪念碑", lat: 23.564752, lng: 113.781339 },
{ label: "大田村苏塘路古井", lat: 23.290103, lng: 113.624265 },
{ label: "五联村凉亭", lat: 23.36866, lng: 113.822033 },
{ label: "龙岗村古桥", lat: 23.295692, lng: 113.710031 },
{ label: "木棉村公社礼堂", lat: 23.546277, lng: 113.585226 },
{ label: "钱岗村兰集堂", lat: 23.546277, lng: 113.585226 },
{ label: "广钢铁路专用线花地河大桥", lat: 23.093203, lng: 113.224566 },
{ label: "珠江电影制片厂行政楼旧址", lat: 23.094607, lng: 113.321088 }
    ]
  },
  {
    label: "Religious Buildings",
    visible: false,
    items: [
      { label: "小洲村玉虚宫", lat: 23.061028, lng: 113.355997 },
{ label: "同福中路伍氏宗祠旧址", lat: 23.103996, lng: 113.257574 },
{ label: "方石曹氏宗祠", lat: 23.319805, lng: 113.288335 },
{ label: "广伦钟公祠", lat: 23.244256, lng: 113.283213 },
{ label: "南野公祠", lat: 23.546277, lng: 113.585226 },
{ label: "必遂李公祠", lat: 23.546277, lng: 113.585226 },
{ label: "寅中祖楼", lat: 23.546277, lng: 113.585226 },
{ label: "仁卿李公祠", lat: 23.546277, lng: 113.585226 },
{ label: "东林梁公祠", lat: 23.052134, lng: 113.374942 },
{ label: "元始梁公祠", lat: 23.050954, lng: 113.373817 },
{ label: "南园崔公祠", lat: 23.047802, lng: 113.372137 },
{ label: "北亭村陈氏宗祠", lat: 23.047285, lng: 113.372265 },
{ label: "愚菴崔公祠", lat: 23.047285, lng: 113.372265 },
{ label: "福缘林公祠", lat: 22.964403, lng: 113.354433 },
{ label: "斐客白公祠", lat: 23.080506, lng: 113.333954 },
{ label: "洪积刘公祠", lat: 23.374185, lng: 113.266123 },
{ label: "贤德刘公祠", lat: 23.374185, lng: 113.266123 },
{ label: "文鳯陆公祠", lat: 23.103278, lng: 113.46463 },
{ label: "秀之刘公祠", lat: 23.20335, lng: 113.53686 },
{ label: "郑田庙岭村石王古庙", lat: 23.217179, lng: 113.827773 },
{ label: "长流村镇庆庙", lat: 23.736767, lng: 113.803976 },
{ label: "沙湾镇承芳里社稷坛", lat: 22.907173, lng: 113.335969 },
{ label: "沙湾镇何氏翰林祠", lat: 22.905033, lng: 113.337591 },
{ label: "沙湾镇何氏三代文魁祠", lat: 22.907578, lng: 113.340768 },
{ label: "伯季合祠", lat: 23.076809, lng: 113.513388 },
{ label: "济川江公祠", lat: 23.279395, lng: 113.235404 },
{ label: "羽吾大夫祠", lat: 23.273033, lng: 113.237548 },
{ label: "南清江公祠", lat: 23.311312, lng: 113.240493 },
{ label: "宥庄沈公祠", lat: 23.325988, lng: 113.285755 },
{ label: "永荫堂", lat: 23.34957, lng: 113.291662 },
{ label: "国政周公祠", lat: 23.165352, lng: 113.240501 },
{ label: "白土村和益南街方氏祠堂", lat: 23.357504, lng: 113.43059 },
{ label: "光明村宋氏祠堂", lat: 23.33818, lng: 113.415153 },
{ label: "光明村梅州司铎", lat: 23.33765, lng: 113.416094 },
{ label: "岭东村冯公四房祠", lat: 22.790564, lng: 113.396373 },
{ label: "仲贵祖祠", lat: 22.764949, lng: 113.579407 },
{ label: "塘坑村朱氏公祠", lat: 22.753098, lng: 113.573064 },
{ label: "林隐陈公祠", lat: 23.037954, lng: 113.451157 },
{ label: "沙涌村祠堂", lat: 22.956052, lng: 113.425467 },
{ label: "礼村高氏二房祠堂", lat: 23.040805, lng: 113.312638 },
{ label: "潭山村天后宫", lat: 22.992833, lng: 113.449823 },
{ label: "南昌祖祠", lat: 23.048176, lng: 113.445768 },
{ label: "江南村李氏宗祠", lat: 22.992414, lng: 113.368022 },
{ label: "楚庭陈公祠", lat: 22.983587, lng: 113.399634 },
{ label: "茂盛陈公祠", lat: 22.983914, lng: 113.399786 },
{ label: "紫坭村韩氏宗祠", lat: 22.896683, lng: 113.290696 },
{ label: "秉熙曾公祠", lat: 22.961393, lng: 113.434121 },
{ label: "李氏宗祠（敦本堂）", lat: 23.122054, lng: 113.233391 },
{ label: "礼祐关公祠", lat: 23.059294, lng: 113.234761 },
{ label: "善崙蔡公祠", lat: 23.128874, lng: 113.233617 },
{ label: "德华潘公祠", lat: 23.127346, lng: 113.340076 },
{ label: "上社村仁圣宫", lat: 23.13481, lng: 113.373299 },
{ label: "慕隐潘公祠", lat: 23.125427, lng: 113.386516 },
{ label: "镇龙村黄氏宗祠", lat: 23.27971, lng: 113.57342 },
{ label: "伦江张公祠", lat: 23.081318, lng: 113.501179 },
{ label: "横坑村观音古庙", lat: 23.130587, lng: 113.460339 },
{ label: "子安刘公祠", lat: 23.203473, lng: 113.535129 },
{ label: "颖远任公祠", lat: 23.436279, lng: 113.052397 },
{ label: "自求钟公祠", lat: 23.340283, lng: 113.096101 },
{ label: "直斋公祠", lat: 23.197042, lng: 113.769726 },
{ label: "仙塘村冯氏宗祠", lat: 23.152781, lng: 113.825011 },
{ label: "诒榖单公祠", lat: 23.165483, lng: 113.801021 },
{ label: "东洲村东洲大道钟氏大宗祠", lat: 23.098219, lng: 113.592361 },
{ label: "湾谷村罗氏祠堂", lat: 23.201741, lng: 113.665791 },
{ label: "郭村达宽郭公祠", lat: 22.935567, lng: 112.182537 },
{ label: "光耀村又昌路陈氏祠堂", lat: 23.3549, lng: 113.854952 },
{ label: "光耀村新屋路陈氏祠堂", lat: 23.3549, lng: 113.854952 },
{ label: "黄塘村梁氏宗祠", lat: 23.403936, lng: 113.852769 },
{ label: "西湖滩村郑氏祠堂", lat: 23.403327, lng: 113.890401 },
{ label: "老屋村郭氏祠堂", lat: 23.371006, lng: 113.618712 },
{ label: "横塱村刘氏宗祠", lat: 23.257928, lng: 113.71489 },
{ label: "君松徐公祠", lat: 23.546277, lng: 113.585226 },
{ label: "龙聚村曾氏宗祠", lat: 23.546277, lng: 113.585226 },
{ label: "龙聚村胡氏宗祠", lat: 23.546277, lng: 113.585226 },
{ label: "龙聚村胡氏祠堂", lat: 23.546277, lng: 113.585226 },
{ label: "济尧梁公祠", lat: 23.57576, lng: 113.425751 },
{ label: "悦涯祖祠", lat: 23.546277, lng: 113.585226 },
{ label: "春盛公祠", lat: 23.546277, lng: 113.585226 },
{ label: "埔顶将军楼", lat: 23.546277, lng: 113.585226 },
{ label: "大凹村李氏宗祠", lat: 23.511276, lng: 113.558123 },
{ label: "约斋黄公祠", lat: 23.546277, lng: 113.585226 },
{ label: "南向村钟氏宗祠", lat: 23.546277, lng: 113.585226 },
{ label: "天颖廖公祠", lat: 23.546277, lng: 113.585226 },
{ label: "原英陈公祠", lat: 23.546277, lng: 113.585226 },
{ label: "民国广东警备司令部旧址", lat: 23.13023, lng: 113.267167 }
    ]
  },
  {
    label: "Residential Buildings",
    visible: false,
    items: [
      { label: "永安家塾", lat: 23.108895, lng: 113.437802 },
{ label: "冠英家塾旧址", lat: 23.123504, lng: 113.266766 },
{ label: "双溪别墅", lat: 23.19637, lng: 113.308289 },
{ label: "三元里大街二十七巷9号民居", lat: 23.158581, lng: 113.261146 },
{ label: "宝龙直街10号民居", lat: 23.10218, lng: 113.26965 },
{ label: "宝龙直街18、20号民居", lat: 23.102537, lng: 113.260447 },
{ label: "福居里3号民居", lat: 23.105898, lng: 113.259862 },
{ label: "龙福东二巷2号民居", lat: 23.092994, lng: 113.267038 },
{ label: "龙福东一巷4号民居", lat: 23.103547, lng: 113.259155 },
{ label: "顾庐、康庐", lat: 23.103471, lng: 113.259044 },
{ label: "龙延里2-1号民居", lat: 22.617597, lng: 110.154556 },
{ label: "龙骧大街11号民居", lat: 23.103414, lng: 113.260509 },
{ label: "龙骧大街12、14号民居", lat: 23.102172, lng: 113.269735 },
{ label: "龙骧大街15号民居", lat: 23.101523, lng: 113.261813 },
{ label: "龙骧大街16号民居", lat: 23.102845, lng: 113.259992 },
{ label: "龙骧大街19号民居", lat: 23.102988, lng: 113.260298 },
{ label: "龙骧大街21号民居", lat: 23.101651, lng: 113.261782 },
{ label: "龙骧大街22号民居", lat: 23.102573, lng: 113.260056 },
{ label: "龙骧大街24号民居", lat: 23.102514, lng: 113.260064 },
{ label: "龙骧大街3号民居", lat: 23.103204, lng: 113.260142 },
{ label: "龙骧大街4号民居", lat: 23.103218, lng: 113.260397 },
{ label: "龙骧大街8、10号民居", lat: 23.10218, lng: 113.26965 },
{ label: "关山月旧居", lat: 23.093763, lng: 113.277462 },
{ label: "大塘村西华大街10号民居", lat: 23.089533, lng: 113.263902 },
{ label: "昆仑三街10、12号民居", lat: 23.102175, lng: 113.269695 },
{ label: "昆仑三街29、29-1、29-2号民居", lat: 23.098259, lng: 113.258112 },
{ label: "肇昌堂", lat: 23.059144, lng: 113.312318 },
{ label: "梅园西路38号民居", lat: 23.093974, lng: 113.256174 },
{ label: "栖栅南街19号民居", lat: 23.103505, lng: 113.255396 },
{ label: "栖栅南街40号民居", lat: 23.104056, lng: 113.255345 },
{ label: "前进路18号民居", lat: 23.103562, lng: 113.271735 },
{ label: "前进路54号-28民居", lat: 23.099783, lng: 113.274614 },
{ label: "前进路54号-30民居", lat: 23.100231, lng: 113.274727 },
{ label: "同庆四街1号民居", lat: 23.10796, lng: 113.265824 },
{ label: "跃龙南27号民居", lat: 23.108746, lng: 113.265536 },
{ label: "溪峡街13、13-1号民居", lat: 23.103947, lng: 113.256861 },
{ label: "溪峡街1号民居", lat: 23.10334, lng: 113.25683 },
{ label: "溪峡街7号民居", lat: 23.103717, lng: 113.256848 },
{ label: "溪峡新街18号民居", lat: 23.104496, lng: 113.257102 },
{ label: "溪峡新街1—13（单号）号民居", lat: 23.10434, lng: 113.256767 },
{ label: "伍家祠道9、11号民居", lat: 23.103843, lng: 113.257292 },
{ label: "蟠龙西1-2号民居", lat: 23.066978, lng: 113.186086 },
{ label: "蟠龙西新巷1号民居", lat: 23.10525, lng: 113.263113 },
{ label: "蟠龙西新巷7、7-1号民居", lat: 23.10525, lng: 113.263113 },
{ label: "同和里18号民居", lat: 23.100417, lng: 113.260153 },
{ label: "存善东横街13号民居", lat: 22.545915, lng: 113.381893 },
{ label: "存善南街4号民居", lat: 23.119174, lng: 113.242457 },
{ label: "存善西街1号民居", lat: 23.119861, lng: 113.242475 },
{ label: "存善正街15、17号民居", lat: 23.119482, lng: 113.24243 },
{ label: "存善正街4、6、8号民居", lat: 23.119464, lng: 113.242759 },
{ label: "宝源路123号民居", lat: 23.118763, lng: 113.241065 },
{ label: "宝源路125号民居", lat: 23.118795, lng: 113.241122 },
{ label: "宝源路127号民居", lat: 23.118745, lng: 113.24118 },
{ label: "宝源路139号民居", lat: 23.118725, lng: 113.241592 },
{ label: "明勤第", lat: 23.11876, lng: 113.241584 },
{ label: "宝源中约11号民居", lat: 23.119061, lng: 113.241193 },
{ label: "宝源中约25号民居", lat: 23.119135, lng: 113.240781 },
{ label: "宝源中约48号民居", lat: 23.119336, lng: 113.240243 },
{ label: "宝源中约54号民居", lat: 23.119351, lng: 113.24001 },
{ label: "宝源中约56号民居", lat: 23.119358, lng: 113.239962 },
{ label: "昌华大街2-2号民居", lat: 23.115761, lng: 113.236122 },
{ label: "昌华大街24号民居", lat: 23.115827, lng: 113.234904 },
{ label: "昌华大街8号后座民居", lat: 23.115797, lng: 113.235333 },
{ label: "昌华庐", lat: 23.115587, lng: 113.234622 },
{ label: "昌华新街12号民居", lat: 23.115359, lng: 113.234943 },
{ label: "昌华新街14号民居", lat: 23.115359, lng: 113.234892 },
{ label: "昌华新街3-1号民居", lat: 23.115192, lng: 113.235285 },
{ label: "昌华新街8、10号民居", lat: 23.115348, lng: 113.235063 },
{ label: "昌华新街9号民居", lat: 23.115246, lng: 113.234916 },
{ label: "多宝街49号民居", lat: 23.116379, lng: 113.235945 },
{ label: "多宝街51号民居", lat: 23.116378, lng: 113.235863 },
{ label: "多宝街58、58-1号民居", lat: 23.116542, lng: 113.235603 },
{ label: "多宝街81号民居", lat: 23.116429, lng: 113.23509 },
{ label: "多宝路183、185号民居", lat: 23.116667, lng: 113.239873 },
{ label: "多宝路189、191号民居", lat: 23.116653, lng: 113.240226 },
{ label: "多宝南横20号民居", lat: 23.116141, lng: 113.235267 },
{ label: "多宝南横38号民居", lat: 23.11605, lng: 113.23496 },
{ label: "多宝南横6-1、6-2号民居", lat: 23.11612, lng: 113.23598 },
{ label: "多宝南横6号民居", lat: 23.116114, lng: 113.235974 },
{ label: "逢源正中约18、20号民居", lat: 23.120473, lng: 113.239308 },
{ label: "鸣谦里9号民居", lat: 23.116555, lng: 113.251259 },
{ label: "和平中路114号民居", lat: 23.1115, lng: 113.246503 },
{ label: "和息里27号民居", lat: 23.110619, lng: 113.244126 },
{ label: "民治大街32号民居", lat: 23.09873, lng: 113.23747 },
{ label: "民治大街34号民居", lat: 23.09901, lng: 113.23757 },
{ label: "富善西街15号民居", lat: 23.11277, lng: 113.247817 },
{ label: "富善西街19号民居", lat: 23.112927, lng: 113.247773 },
{ label: "富善一巷2-2、2-3号民居", lat: 23.112472, lng: 113.248106 },
{ label: "怀远驿37号民居", lat: 23.111981, lng: 113.248774 },
{ label: "怀远驿42号民居", lat: 23.111981, lng: 113.248774 },
{ label: "冼基东19号民居", lat: 23.111981, lng: 113.248774 },
{ label: "耀华大街11号民居", lat: 23.118601, lng: 113.24518 },
{ label: "耀华大街13、13-1号民居", lat: 23.11865, lng: 113.245185 },
{ label: "耀华大街15、15-1号民居", lat: 23.118699, lng: 113.24519 },
{ label: "耀华大街17、19号民居", lat: 23.118748, lng: 113.245195 },
{ label: "耀华大街1、3号民居", lat: 23.118403, lng: 113.245183 },
{ label: "耀华大街20号民居", lat: 23.118727, lng: 113.245167 },
{ label: "耀华大街23号民居", lat: 23.118706, lng: 113.245139 },
{ label: "耀华大街24、24-1号民居", lat: 23.118698, lng: 113.24513 },
{ label: "耀华大街28、28-1号民居", lat: 23.11867, lng: 113.245093 },
{ label: "耀华大街30号民居", lat: 23.118656, lng: 113.245075 },
{ label: "耀华大街32号民居", lat: 23.118642, lng: 113.245056 },
{ label: "耀华大街9、9-1号民居", lat: 23.118559, lng: 113.245186 },
{ label: "粤华西一街18、20号民居", lat: 21.643599, lng: 110.92898 },
{ label: "民兴里2、4、6号民居", lat: 23.119185, lng: 113.261895 },
{ label: "雅荷塘69号民居", lat: 23.129088, lng: 113.275981 },
{ label: "东皋大道11号院民居", lat: 23.128463, lng: 113.281971 },
{ label: "东皋二横路3、5号民居", lat: 23.129062, lng: 113.281999 },
{ label: "东皋二横路4号民居", lat: 23.129062, lng: 113.281999 },
{ label: "东皋二横路6号民居", lat: 23.129062, lng: 113.281999 },
{ label: "东皋二横路8号民居", lat: 23.129062, lng: 113.281999 },
{ label: "东皋一横路14、16号民居", lat: 23.128463, lng: 113.281971 },
{ label: "东皋一横路2号民居", lat: 23.128371, lng: 113.281453 },
{ label: "东皋一横路3号民居", lat: 23.128463, lng: 113.281971 },
{ label: "东皋一横路7号民居", lat: 23.128463, lng: 113.281971 },
{ label: "皋园4号民居", lat: 23.12847, lng: 113.281279 },
{ label: "皋园7号民居", lat: 23.12847, lng: 113.281279 },
{ label: "礼兴街10号民居", lat: 23.128095, lng: 113.280113 },
{ label: "仁兴街2号民居", lat: 23.12847, lng: 113.281279 },
{ label: "义兴园1号民居", lat: 23.12847, lng: 113.281279 },
{ label: "智兴街2号民居", lat: 23.128962, lng: 113.281089 },
{ label: "礼兴街11、13、15号民居", lat: 23.1281, lng: 113.28064 },
{ label: "连云里2、4、6、8号民居", lat: 23.119711, lng: 113.26872 },
{ label: "观绿路10、10-1号民居、广华道1—15号（单号）民居", lat: 23.118798, lng: 113.254811 },
{ label: "观绿路2-2、2-3号民居", lat: 23.118739, lng: 113.25561 },
{ label: "观绿路2-4号民居", lat: 23.11869, lng: 113.2554 },
{ label: "观绿路4-1、4-2号民居", lat: 23.118725, lng: 113.255245 },
{ label: "观绿路6、8号民居", lat: 23.118683, lng: 113.255166 },
{ label: "观绿路7号民居", lat: 23.118526, lng: 113.25512 },
{ label: "观绿新街16号民居", lat: 23.118664, lng: 113.254131 },
{ label: "广华道18号民居", lat: 23.118664, lng: 113.254131 },
{ label: "广华道2、4、6、8号民居", lat: 22.313372, lng: 114.178067 },
{ label: "杏花巷民居", lat: 23.123184, lng: 113.257064 },
{ label: "广福巷1、3号民居", lat: 23.127817, lng: 113.26656 },
{ label: "海珠中路151、153号民居", lat: 23.121429, lng: 113.256588 },
{ label: "海珠中路162、164、166号民居", lat: 23.120915, lng: 113.256688 },
{ label: "豪贤路86号民居", lat: 23.130353, lng: 113.275323 },
{ label: "进步里1号民居", lat: 23.122257, lng: 113.258025 },
{ label: "南濠街42、42-1号民居", lat: 23.119404, lng: 113.256584 },
{ label: "南濠街81-1、81-2、83号民居", lat: 23.11968, lng: 113.256529 },
{ label: "霍芝庭公馆旧址", lat: 23.126, lng: 113.262472 },
{ label: "金城巷1—12号民居", lat: 23.121911, lng: 113.260166 },
{ label: "南朝街1号民居", lat: 23.124107, lng: 113.266276 },
{ label: "模范住宅区旧址农林上路12号", lat: 23.125134, lng: 113.297128 },
{ label: "模范住宅区旧址农林上路14号", lat: 23.125219, lng: 113.297128 },
{ label: "模范住宅区旧址农林上路二横路2号", lat: 23.125901, lng: 113.297526 },
{ label: "模范住宅区旧址农林上路二横路4号", lat: 23.125889, lng: 113.297662 },
{ label: "模范住宅区旧址农林上路二横路6号", lat: 23.125868, lng: 113.297806 },
{ label: "模范住宅区旧址农林上路七横路7号", lat: 23.128215, lng: 113.298543 },
{ label: "模范住宅区旧址农林下路19号", lat: 23.127157, lng: 113.295605 },
{ label: "畸零里5号民居", lat: 23.116494, lng: 113.26488 },
{ label: "启明大马路5号民居", lat: 23.121351, lng: 113.293657 },
{ label: "秦牧旧居", lat: 23.120852, lng: 113.293344 },
{ label: "启明横马路11-2号民居", lat: 23.121763, lng: 113.292647 },
{ label: "启明横马路17号民居", lat: 23.121386, lng: 113.292689 },
{ label: "启明横马路1号民居", lat: 23.121193, lng: 113.292493 },
{ label: "启明四马路11号民居", lat: 23.121576, lng: 113.293092 },
{ label: "启明四马路4号民居", lat: 23.121577, lng: 113.293508 },
{ label: "模范住宅区旧址三育路32号", lat: 23.129294, lng: 113.299819 },
{ label: "模范住宅区旧址三育路44号", lat: 23.129764, lng: 113.299751 },
{ label: "诗书路117、119、121号民居", lat: 23.120369, lng: 113.254665 },
{ label: "诗书路68号民居", lat: 23.118894, lng: 113.254603 },
{ label: "诗书路78号后座民居", lat: 23.119061, lng: 113.254631 },
{ label: "仁亨里15、15-1号民居", lat: 23.119845, lng: 113.254532 },
{ label: "仁亨里1、1-1号民居", lat: 23.119845, lng: 113.254353 },
{ label: "木排横街11号民居", lat: 23.117704, lng: 113.266758 },
{ label: "木排头2、2-1号民居", lat: 23.118857, lng: 113.268261 },
{ label: "木排头57、59、61、63号民居", lat: 23.118154, lng: 113.267309 },
{ label: "宜安里29号民居", lat: 23.117433, lng: 113.265962 },
{ label: "文德路43、43-1号民居", lat: 23.121624, lng: 113.272114 },
{ label: "文德路45、47号民居", lat: 23.116962, lng: 113.272559 },
{ label: "仰忠街14、14-1号民居", lat: 23.121289, lng: 113.271033 },
{ label: "小北路222~228号（双号）民居", lat: 23.137015, lng: 113.273386 },
{ label: "学宫街28、30号民居", lat: 23.12128, lng: 113.261719 },
{ label: "盐运西二巷2号民居", lat: 23.121325, lng: 113.265609 },
{ label: "梧庐", lat: 23.12143, lng: 113.265294 },
{ label: "盐运西一巷18、20号民居", lat: 23.120894, lng: 113.265152 },
{ label: "盐运西一巷13、15号民居", lat: 23.121167, lng: 113.265381 },
{ label: "盐运西一巷14号民居", lat: 23.12093, lng: 113.265316 },
{ label: "盐运西一巷2、2-1、2-2号民居", lat: 23.12077, lng: 113.265731 },
{ label: "盐运西一巷5号民居", lat: 23.120988, lng: 113.265595 },
{ label: "盐运西正街19、21、23、25、27号民居", lat: 23.121842, lng: 113.265575 },
{ label: "盐运西正街1、3、5号民居", lat: 23.121276, lng: 113.265723 },
{ label: "盐运西正街26、28号民居", lat: 23.121952, lng: 113.265683 },
{ label: "越秀北路林克明旧居", lat: 23.134612, lng: 113.275094 },
{ label: "越秀北路78号", lat: 23.128631, lng: 113.278769 },
{ label: "模范住宅区旧址执信南路9号", lat: 23.125397, lng: 113.293067 },
{ label: "纸行路42号民居", lat: 23.122107, lng: 113.255201 },
{ label: "白沙巷10-1号民居", lat: 23.122038, lng: 113.254299 },
{ label: "白沙巷21、21-1号民居", lat: 23.121681, lng: 113.254288 },
{ label: "白沙巷27、29、31号民居", lat: 23.122006, lng: 113.253947 },
{ label: "侨星新街4、6号民居", lat: 23.121559, lng: 113.25469 },
{ label: "侨星新街8—18（双号）号民居", lat: 23.121566, lng: 113.254653 },
{ label: "通宁道14、16、18、20号民居", lat: 23.123288, lng: 113.254932 },
{ label: "通宁道17、19、21、23、25号民居", lat: 23.123266, lng: 113.254835 },
{ label: "通宁道22、24、26号民居", lat: 23.123364, lng: 113.2548 },
{ label: "通宁道2、4号民居", lat: 23.123283, lng: 113.25522 },
{ label: "通宁道6、8、10、12号民居", lat: 23.123313, lng: 113.255134 },
{ label: "通宁道9、11、13、15号民居", lat: 23.12333, lng: 113.255088 },
{ label: "模范住宅区旧址菜园西35号", lat: 23.125031, lng: 113.290929 },
{ label: "中山六路76号民居", lat: 23.125402, lng: 113.259081 },
{ label: "苏鸣一旧居", lat: 23.124852, lng: 113.258056 },
{ label: "玛瑙巷55号民居", lat: 23.124892, lng: 113.258054 },
{ label: "中山三路2号民居", lat: 23.126675, lng: 113.286422 },
{ label: "中山三路4号民居", lat: 23.126719, lng: 113.286379 },
{ label: "模范住宅区旧址梅花村29号", lat: 23.127492, lng: 113.30484 },
{ label: "模范住宅区旧址梅花村34号", lat: 23.127492, lng: 113.30484 },
{ label: "模范住宅区旧址梅花村69号", lat: 23.12826, lng: 113.3047 },
{ label: "咸虾栏14号、侨庆坊1、3号民居", lat: 23.118477, lng: 113.27444 },
{ label: "模范住宅区旧址竹丝岗大马路1号", lat: 23.127449, lng: 113.29327 },
{ label: "模范住宅区旧址竹丝岗二马路14号", lat: 23.127158, lng: 113.294139 },
{ label: "模范住宅区旧址竹丝岗二马路43号", lat: 23.129056, lng: 113.296189 },
{ label: "模范住宅区旧址竹丝岗三马路1号", lat: 23.126664, lng: 113.293439 },
{ label: "模范住宅区旧址竹丝岗四马路1号", lat: 23.126374, lng: 113.293567 },
{ label: "光复南路113号", lat: 23.114484, lng: 113.252138 },
{ label: "光复南路121号", lat: 23.114684, lng: 113.252117 },
{ label: "光复南路139、141、143号", lat: 23.115091, lng: 113.251975 },
{ label: "光复南路145号", lat: 23.114499, lng: 113.252183 },
{ label: "光复南路176号", lat: 23.115636, lng: 113.252041 },
{ label: "光复南路21号", lat: 23.112871, lng: 113.252674 },
{ label: "光复南路26号", lat: 23.112885, lng: 113.252914 },
{ label: "光复南路28号", lat: 23.112904, lng: 113.25291 },
{ label: "光复南路30号", lat: 23.112925, lng: 113.252905 },
{ label: "光复南路32号", lat: 23.112946, lng: 113.252903 },
{ label: "光复南路40号", lat: 23.113007, lng: 113.252808 },
{ label: "光复南路48号", lat: 23.113263, lng: 113.252816 },
{ label: "光复南路50号", lat: 23.113295, lng: 113.252809 },
{ label: "光复南路54号", lat: 23.11338, lng: 113.252749 },
{ label: "光复南路56号", lat: 23.113394, lng: 113.252782 },
{ label: "光复南路68号", lat: 23.113816, lng: 113.252619 },
{ label: "光复南路87号", lat: 23.114064, lng: 113.252243 },
{ label: "光复南路89号", lat: 23.114098, lng: 113.252234 },
{ label: "光复南路99号", lat: 23.114249, lng: 113.252187 },
{ label: "十八甫路107、109、111号", lat: 23.111922, lng: 113.247548 },
{ label: "十八甫路132、134号", lat: 23.112115, lng: 113.2469 },
{ label: "十八甫路136号", lat: 23.112108, lng: 113.246838 },
{ label: "十八甫路33号", lat: 23.112027, lng: 113.249472 },
{ label: "十八甫路55号", lat: 23.111965, lng: 113.248985 },
{ label: "十八甫路82、84号", lat: 23.112104, lng: 113.248267 },
{ label: "十八甫路90号", lat: 23.112123, lng: 113.248055 },
{ label: "十八甫路92号", lat: 23.112074, lng: 113.247913 },
{ label: "十八甫路93号", lat: 23.111898, lng: 113.248077 },
{ label: "十八甫路98号", lat: 23.112078, lng: 113.247807 },
{ label: "沿江西路47号", lat: 23.10837, lng: 113.252686 },
{ label: "杨巷路107号", lat: 23.114776, lng: 113.24963 },
{ label: "杨巷路29、29-2号", lat: 23.112958, lng: 113.249815 },
{ label: "惠福东路401、403号", lat: 23.120582, lng: 113.264855 },
{ label: "惠福东路413、415号", lat: 23.120662, lng: 113.265143 },
{ label: "纸行路11、13、15号", lat: 23.121336, lng: 113.254861 },
{ label: "纸行路41、43、45号", lat: 23.122652, lng: 113.255216 },
{ label: "纸行路56、58、60号", lat: 23.122411, lng: 113.255308 },
{ label: "纸行路59、61、63号", lat: 23.123033, lng: 113.25527 },
{ label: "钟落潭村福龙路129号民居", lat: 23.386005, lng: 113.402636 },
{ label: "梅田村迎龙门楼", lat: 23.358641, lng: 113.413964 },
{ label: "显扬梁公家塾", lat: 23.048437, lng: 113.372766 },
{ label: "大岭村龙津街上达巷1号民居", lat: 22.985158, lng: 113.477564 },
{ label: "大岭村昇平街永福巷2号民居", lat: 22.985158, lng: 113.477564 },
{ label: "大岭村中兴街仁厚一巷8号民居", lat: 22.985158, lng: 113.477564 },
{ label: "贝岗村民居", lat: 23.052602, lng: 113.380118 },
{ label: "庚辉坊北街10号民居", lat: 22.950782, lng: 113.443486 },
{ label: "穗石村西市大街13号民居", lat: 23.046805, lng: 113.410209 },
{ label: "秀发村得月街3号民居", lat: 23.039571, lng: 113.420563 },
{ label: "黄埔村盘石大街13号民居", lat: 23.090686, lng: 113.397309 },
{ label: "黄埔村盘石大街八巷4号民居", lat: 23.091421, lng: 113.398256 },
{ label: "同福西路歧兴中北4-1民居", lat: 23.102926, lng: 113.252755 },
{ label: "洛场村十队21号民居", lat: 23.424357, lng: 113.237597 },
{ label: "平东村平东七队141号民居", lat: 23.425514, lng: 113.29199 },
{ label: "平东村平东四队59号民居", lat: 23.431137, lng: 113.28859 },
{ label: "利明别墅", lat: 23.426236, lng: 113.295192 },
{ label: "大同别墅", lat: 23.384564, lng: 113.258936 },
{ label: "十五甫正街18号之一民居", lat: 23.115629, lng: 113.240936 },
{ label: "逢源路莲塘二巷13号民居", lat: 23.118211, lng: 113.240228 },
{ label: "九佛人民公社礼堂旧址", lat: 23.353943, lng: 113.521179 },
{ label: "保安南街3号民居", lat: 23.120022, lng: 113.30057 },
{ label: "保安前街13号民居", lat: 23.120438, lng: 113.300682 },
{ label: "龟岗三马路16、18、20号民居", lat: 23.120662, lng: 113.293617 },
{ label: "均益路5号民居", lat: 23.121521, lng: 113.291596 },
{ label: "启明二马路5号民居", lat: 23.120964, lng: 113.292375 },
{ label: "启明二马路6号民居", lat: 23.120867, lng: 113.293137 },
{ label: "横岭村大塘尾家驹家塾", lat: 23.612785, lng: 113.483824 },
{ label: "沙湾镇恒庐", lat: 22.906841, lng: 113.338301 },
{ label: "何炳林故居", lat: 22.907173, lng: 113.335969 },
{ label: "新民十一街22、24号民居", lat: 23.09399, lng: 113.25397 },
{ label: "新民十一街4、6号民居", lat: 23.093581, lng: 113.254067 },
{ label: "南福安街4号后座民居", lat: 23.105028, lng: 113.255301 },
{ label: "栖栅南街26、28号民居", lat: 23.103996, lng: 113.254849 },
{ label: "栖栅南街2号民居", lat: 23.103594, lng: 113.254789 },
{ label: "栖栅南街52号民居", lat: 23.103479, lng: 113.255227 },
{ label: "栖栅南街6号民居", lat: 23.104074, lng: 113.255881 },
{ label: "朗头村农家乐里13号民居", lat: 23.352072, lng: 113.075299 },
{ label: "朗头村农家乐里24号民居", lat: 23.352072, lng: 113.075299 },
{ label: "正吉坊康乐里1号民居", lat: 23.073367, lng: 113.407578 },
{ label: "宝源路63号民居", lat: 23.11894, lng: 113.238652 },
{ label: "宝源路70、72号及后座民居", lat: 23.118797, lng: 113.238495 },
{ label: "宝源路73、75号民居", lat: 23.118903, lng: 113.239123 },
{ label: "宝源路85号民居", lat: 23.118864, lng: 113.239756 },
{ label: "豆栏上街12号民居", lat: 23.11201, lng: 113.253006 },
{ label: "桨栏路102号", lat: 23.112203, lng: 113.251176 },
{ label: "桨栏路56号", lat: 23.112324, lng: 113.252252 },
{ label: "丁颖旧居", lat: 23.158908, lng: 113.356424 },
{ label: "华南农学院巢湖路独立住宅", lat: 23.154376, lng: 113.354889 },
{ label: "东昌大街17号之2民居", lat: 23.126451, lng: 113.281192 },
{ label: "东昌大街26、28号民居", lat: 23.126166, lng: 113.281321 },
{ label: "东昌大街34、36号民居", lat: 23.126185, lng: 113.280865 },
{ label: "麦栏街2号民居", lat: 23.118672, lng: 113.270838 },
{ label: "仁生里44号民居", lat: 23.129026, lng: 113.271884 },
{ label: "华安楼", lat: 23.116452, lng: 113.266759 },
{ label: "小东营19号（锦荣街5号民居）", lat: 23.129883, lng: 113.270178 },
{ label: "小东营38号民居", lat: 23.129597, lng: 113.270067 },
{ label: "越华路47号民居", lat: 23.129069, lng: 113.270209 },
{ label: "越秀北路408号民居", lat: 23.134946, lng: 113.274441 },
{ label: "红线女旧居", lat: 23.139514, lng: 113.291351 },
{ label: "詠沂别苑", lat: 23.329836, lng: 113.156881 },
{ label: "张升楼", lat: 22.825229, lng: 113.506211 },
{ label: "黄阁镇猎德上巷1号民居", lat: 22.825829, lng: 113.493671 },
{ label: "黄阁镇猎德上巷3号民居", lat: 22.825829, lng: 113.493671 },
{ label: "黄阁镇大塘西街34号民居", lat: 22.825829, lng: 113.493671 },
{ label: "美友家塾", lat: 22.965933, lng: 113.394927 },
{ label: "朗存家塾", lat: 23.033288, lng: 113.419668 },
{ label: "中约街石狮巷24号民居", lat: 22.98502, lng: 113.397329 },
{ label: "桂桂坊大街九市巷6号民居", lat: 23.020294, lng: 113.360667 },
{ label: "海傍后街78号民居", lat: 22.932232, lng: 113.362852 },
{ label: "耀滔家塾", lat: 22.982491, lng: 113.309122 },
{ label: "启明一马路9号民居", lat: 23.120664, lng: 113.292943 },
{ label: "耀庐", lat: 23.122343, lng: 113.294638 },
{ label: "文德路75号", lat: 23.123689, lng: 113.27144 },
{ label: "保宁路1号民居", lat: 23.11971, lng: 113.301303 },
{ label: "春园后街12号民居", lat: 23.118614, lng: 113.295604 },
{ label: "培正二横路22号民居", lat: 23.119264, lng: 113.298135 },
{ label: "新河浦二横路29号", lat: 23.116688, lng: 113.300661 },
{ label: "新河浦三横路1号民居", lat: 23.116957, lng: 113.29805 },
{ label: "恤孤院路12号民居", lat: 23.118396, lng: 113.296778 },
{ label: "农林上路二横路17、19号民居", lat: 23.125838, lng: 113.298844 },
{ label: "六和新街10、12号民居", lat: 23.121164, lng: 113.273381 },
{ label: "六和新街14号民居", lat: 23.121164, lng: 113.273381 },
{ label: "六和新街1、3号民居", lat: 23.121164, lng: 113.273381 },
{ label: "六和新街2、4号民居", lat: 23.121164, lng: 113.273381 },
{ label: "六和新街6、8号民居", lat: 23.121164, lng: 113.273381 },
{ label: "六和新街9、11号民居", lat: 23.121164, lng: 113.273381 },
{ label: "培真路二巷13号民居", lat: 23.078471, lng: 113.244879 },
{ label: "逢庆中约12、12-1、12-2号民居", lat: 23.114685, lng: 113.236153 },
{ label: "逢源正街91号民居", lat: 23.11821, lng: 113.236267 },
{ label: "泮塘五约直街41号民居", lat: 23.122502, lng: 113.233706 },
{ label: "多宝路179号民居", lat: 23.116668, lng: 113.239869 },
{ label: "多宝坊14-4、14-5号民居", lat: 23.11555, lng: 113.240172 },
{ label: "多宝街24-1号民居", lat: 23.116421, lng: 113.237453 },
{ label: "逢源中约22号民居", lat: 23.120473, lng: 113.239308 },
{ label: "多宝坊21、21-1号民居", lat: 23.11555, lng: 113.240172 },
{ label: "恩宁西街16、18号民居", lat: 23.113736, lng: 113.239163 },
{ label: "吉祥坊52号民居", lat: 23.114394, lng: 113.240169 },
{ label: "和平西路134号", lat: 23.112008, lng: 113.240759 },
{ label: "宝源路87号民居", lat: 23.11886, lng: 113.239827 },
{ label: "宝源中约38、38-1、40、40-1号民居", lat: 23.119323, lng: 113.24047 },
{ label: "幸福二巷新街7、9号民居", lat: 23.122639, lng: 113.24388 },
{ label: "小甫园18-1号民居", lat: 23.116845, lng: 113.249957 },
{ label: "西林巷18、20号民居", lat: 23.113434, lng: 113.242773 },
{ label: "和平西路50、50-1、50-2、50-3、50-5、50-6、50-7号民居", lat: 23.111469, lng: 113.244869 },
{ label: "和平中路12~20号（双号）民居", lat: 23.111702, lng: 113.249417 },
{ label: "和平中路66、68、70-1、70号民居", lat: 23.111656, lng: 113.248209 },
{ label: "富善三巷23号民居", lat: 23.113005, lng: 113.248183 },
{ label: "光雅里74、76、78、80号民居", lat: 23.113493, lng: 113.246569 },
{ label: "光雅里82、84、86、88号民居", lat: 23.113479, lng: 113.246371 },
{ label: "十七甫北11号民居", lat: 23.112292, lng: 113.24975 },
{ label: "少昆仑蟾宫女旧居", lat: 23.117033, lng: 113.245246 },
{ label: "李禄超旧居", lat: 23.11568, lng: 113.244396 },
{ label: "德昌堂旧址", lat: 23.112917, lng: 113.246187 },
{ label: "永安公司旧址", lat: 23.114911, lng: 113.249615 },
{ label: "豆栏上街14、16号民居", lat: 23.111348, lng: 113.253055 },
{ label: "扬仁东11、13号民居", lat: 23.113874, lng: 113.251592 },
{ label: "扬仁中13号民居", lat: 23.114821, lng: 113.252172 },
{ label: "和平东路39、41号民居", lat: 23.111798, lng: 113.251313 },
{ label: "和平东路43、45号民居", lat: 23.111689, lng: 113.252204 },
{ label: "和平东路54号民居", lat: 23.111894, lng: 113.25203 },
{ label: "和平东路57号民居", lat: 23.111657, lng: 113.252007 },
{ label: "和平东路61号民居", lat: 23.111646, lng: 113.25192 },
{ label: "和平东路62、64号民居", lat: 23.111877, lng: 113.251884 },
{ label: "和平东路65、67号民居", lat: 23.111627, lng: 113.251833 },
{ label: "豆栏上街5号民居", lat: 23.111888, lng: 113.253394 },
{ label: "故衣街39号民居", lat: 23.111706, lng: 113.252479 },
{ label: "和平中路25、27、29号民居", lat: 23.111485, lng: 113.249433 },
{ label: "沿江西路33号民居", lat: 23.10723, lng: 113.251459 },
{ label: "荣华楼", lat: 23.122026, lng: 113.250132 },
{ label: "龙津东路719-1、719-2、719-3、719-4号民居", lat: 23.12249, lng: 113.249069 },
{ label: "美华后街7-3号民居", lat: 23.143029, lng: 113.23756 },
{ label: "西增路30号民居", lat: 23.143726, lng: 113.239709 },
{ label: "联鹤大街10、10-1号民居", lat: 23.098588, lng: 113.257391 },
{ label: "联鹤大街6号民居", lat: 23.098662, lng: 113.257238 },
{ label: "兴隆新街1号民居", lat: 22.98648, lng: 113.880386 },
{ label: "德和南约18号民居", lat: 23.101627, lng: 113.249685 },
{ label: "洪德四巷27、29号民居", lat: 23.101758, lng: 113.251511 },
{ label: "洪德四巷31、33号民居", lat: 23.101932, lng: 113.251328 },
{ label: "宜兴里9号民居", lat: 23.100076, lng: 113.251973 },
{ label: "基立南街15号民居", lat: 23.102847, lng: 113.275388 },
{ label: "广东省昆虫研究所", lat: 23.092844, lng: 113.294334 },
{ label: "颐乐家塾", lat: 23.182755, lng: 113.522842 },
{ label: "凌希天故居", lat: 23.07133, lng: 113.410196 },
{ label: "深井德星里2号民居", lat: 23.107746, lng: 113.450983 },
{ label: "黄沙塘大村九巷民居", lat: 23.407488, lng: 113.055066 },
{ label: "黄沙塘大村九巷31民居", lat: 23.407488, lng: 113.055066 },
{ label: "新屋庄杨氏孖楼（兄弟）", lat: 23.420194, lng: 113.200926 },
{ label: "杨氏更楼", lat: 23.420194, lng: 113.200926 },
{ label: "洛场村三队民居", lat: 23.410316, lng: 113.256926 },
{ label: "礼耕家塾", lat: 23.342885, lng: 113.091623 },
{ label: "叙伦堂", lat: 22.82582, lng: 113.503299 },
{ label: "新窑村辑瑞堂", lat: 23.369651, lng: 113.82431 },
{ label: "夏街路18号民居", lat: 23.284983, lng: 113.836165 },
{ label: "邓村石屋建筑群", lat: 23.470711, lng: 113.819206 },
{ label: "麻车村宁远楼", lat: 23.144172, lng: 113.828939 },
{ label: "黄屋大戏院", lat: 23.471064, lng: 113.934698 },
{ label: "莲舫家塾", lat: 23.58596, lng: 113.367523 },
{ label: "吕中村司马第", lat: 23.546277, lng: 113.585226 },
{ label: "木棉村德仁公楼", lat: 23.546277, lng: 113.585226 },
{ label: "木棉村墨西楼", lat: 23.546277, lng: 113.585226 },
{ label: "刘氏宗祠敦厚堂", lat: 23.546277, lng: 113.585226 },
{ label: "银林村民居", lat: 23.546277, lng: 113.585226 }
    ]
  }
])


const markers = ref<L.Marker[]>([])
const toggleCategory = (index: number) => {
  coordinates.value[index].visible = !coordinates.value[index].visible
  // 确保其他类别被折叠
  coordinates.value.forEach((category, idx) => {
    if (idx !== index) {
      category.visible = false
    }
  })
}

const flyTo = (coord: { label: string; lat: number; lng: number }, subIndex: number) => {
  console.log("flyTo function called")
  console.log("Received coord:", coord)
  console.log("subIndex:", subIndex)
  const latLng = new L.LatLng(coord.lat, coord.lng)
  selectedBuilding.value = coord
  showDetailModal.value = true

  console.log("selectedBuilding set to:", selectedBuilding.value)

  // 构造JSON文件路径并加载内容
  const jsonFileName = `${coord.label}.json`
  const jsonFilePath = `/buildingDescriptions/${jsonFileName}` // 这里使用相对路径
  console.log("Constructed jsonFilePath:", jsonFilePath)

  fetch(jsonFilePath)
    .then(response => {
      console.log("Fetch response status:", response.status)
      if (!response.ok) {
        throw new Error("Network response was not ok")
      }
      return response.json()
    })
    .then(data => {
      console.log("Received JSON data:", data)
      selectedBuildingDescription.value = data.A2_content || "描述不可用"
      console.log("selectedBuildingDescription set to:", selectedBuildingDescription.value)
    })
    .catch(error => {
      console.error("Error loading building description:", error)
      selectedBuildingDescription.value = "暂无"
    })

  // 构造图片路径并加载图片
  const buildingCategory = findBuildingCategory(coord, coordinates.value).toLowerCase().replace(" ", "_")
  const buildingLabel = coord.label.replace(" ", "_")
  const imagePath = `/buildingPic/${buildingCategory}/${buildingLabel}/${buildingLabel}_1.jpg`

  // 将图片路径设置为选中的建筑图片
  selectedBuildingImage.value = imagePath
  console.log("Image path set to:", selectedBuildingImage.value)

  // 将地图视角移动到选中的建筑
  console.log("Setting map view to:", latLng)
  map.setView(latLng, 14)
}

onMounted(() => {
  // Step 2: Initialize Mars2D Map
  
  mars2d.Util.fetchJson({ url: props.url }).then((data: any) => {
    initMars3d({
      ...data.mars2d,
      ...props.options
    })
  }).then(() => {
    // Step 3: Initialize Map Markers
    // Step 3: Initialize Map Markers
    coordinates.value.forEach((category) => {
      category.items.forEach((coord, subIndex) => {
        // 根据 label 选择对应的图标路径
        const iconUrl = getIconUrlByLabel(category.label)

        const marker = L.marker([coord.lat, coord.lng], {
          icon: L.icon({
            iconUrl: iconUrl,
            iconSize: [32, 32],
            iconAnchor: [16, 32]
          })
        }).addTo(map)

        marker.on("click", () => {
          flyTo(coord, subIndex)
        })

        markers.value.push(marker)
      })
    })
  })
})



// 根据 label 返回对应的图标路径
function getIconUrlByLabel(label) {
  switch (label) {
    case "Commercial Buildings":
      return "blue.ico"// 替换为你的图标路径
    case "Industrial Buildings":
      return "yellow.ico" // 替换为你的图标路径
    case "Military Buildings":
      return "red.ico" // 替换为你的图标路径
    case "Public Buildings":
      return "pink.ico" // 替换为你的图标路径
    case "Religious Buildings":
      return "orange.ico" // 替换为你的图标路径
    case "Residential Buildings":
      return "green.ico" // 替换为你的图标路径
    default:
      return "red.ico" // 默认图标路径
  }
}


function findBuildingCategory(building, coordinates) {
  for (const category of coordinates) {
    const found = category.items.find(item => item.label === building.label)
    if (found) {
      return category.label // 返回类别名称
    }
  }
  return "Unknown Category" // 如果未找到，返回未知类别
}


const emit = defineEmits(["onload"])
const initMars3d = (option: any) => {
  const defaultOptions = {
    center: new L.LatLng(23.1291, 113.2644),
    zoom: 12
  }

  const finalOptions = { ...defaultOptions, ...option }

  map = new mars2d.Map(withKeyId.value, finalOptions)

  onMapLoad()
  emit("onload", map)
}

function onMapLoad() {
  // 地图加载完成后的逻辑
}

onBeforeUnmount(() => {
  if (map) {
    map.destroy()
    map = null
  }
  console.log("map销毁完成", map)
})

const userInput = ref("")
const chatMessages = ref<string[]>([])

const sendMessage = async () => {
  if (userInput.value.trim() === "") {
    return
  }

  chatMessages.value.push(`用户: ${userInput.value}`)

  try {
    const response = await fetch("https://api.okmy520.com/v1/chat/completions", {
      method: "POST",
      headers: {
        Authorization: "Bearer sk-QrCh9PnzldDxqTo732402b28A62a4390882fFc9fFc76EaAf",
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        model: "gpt-4-turbo",
        messages: [{ role: "user", content: userInput.value }]
      })
    })

    const data = await response.json()
    const content = data.choices[0].message?.content || ""
    chatMessages.value.push(`AI: ${content}`)

  } catch (error) {
    console.error("Error:", error)
    chatMessages.value.push("AI: 对不起，出错了。")
  } finally {
    userInput.value = ""
  }
}

// 在组件挂载时初始化 ECharts
onMounted(() => {
  if (pieChartContainer.value) {
    // 初始化 ECharts 实例
    const chartInstance = echarts.init(pieChartContainer.value)

    // 配置饼图的数据和选项
    const chartOptions = {
      tooltip: {
        trigger: "item", // 触发提示框
        formatter: "{b}: {c} ({d}%)" // 格式化提示内容为：类型: 数量 (百分比)
      },
      legend: {
        orient: "vertical", // 垂直布局
        left: "0%",
        right: "20%", // 将图例放在右侧并稍微往右移动
        top: "0%", // 垂直居中
        icon: "circle", // 图例的标注形状为圆形
        textStyle: {
          fontSize: 12 // 图例文字大小
        },
        selectedMode: true, // 禁用图例的选中模式
        height: 200, // 设置图例高度
        type: "scroll", // 开启滚动模式
        pageIconColor: "#999", // 设置分页图标颜色
        pageTextStyle: { fontSize: 12 } // 分页文字样式
      },
      series: [
        {
          name: "Number of Buildings",
          type: "pie",
          radius: ["10%", "40%"], // 环形饼图
          center: ["12.5%", "70%"], // 将饼图往左边移动
          avoidLabelOverlap: false,
          label: {
            show: false, // 初始时不显示标签
            position: "outside", // 标签在扇区外部显示
            formatter: "{b}: {c}" // 格式化标签内容，显示建筑类型及数量
          },
          emphasis: {
            label: {
              show: false // 悬停时显示标签
            },
            itemStyle: {
              shadowBlur: 10, // 高亮的阴影模糊度
              shadowOffsetX: 0, // 阴影的水平偏移量
              shadowColor: "rgba(0, 0, 0, 0.5)" // 阴影颜色
            }
          },
          labelLine: {
            show: false
          },
          data: [
            { value: 67, name: "Commercial Buildings", itemStyle: { color: "#9EBCDA" } }, 
            { value: 33, name: "Industrial Buildings", itemStyle: { color: "#F5C44F" } }, 
            { value: 9, name: "Military Buildings", itemStyle: { color: "#FF6B6B" } }, 
            { value: 141, name: "Public Buildings", itemStyle: { color: "#CE90FF" } }, 
            { value: 84, name: "Religious Buildings", itemStyle: { color: "#F97B56" } }, 
            { value: 414, name: "Residential Buildings", itemStyle: { color: "#50CF8C" } } 
          ]
        }
      ]
    }


    // 设置饼图的配置项
    chartInstance.setOption(chartOptions)
    // 监听饼图点击事件，触发建筑列表显示
    chartInstance.on("click", (params) => {
      const selectedCategoryName = params.name
      // 查找对应的类别索引
      const categoryIndex = coordinates.value.findIndex(category => category.label === selectedCategoryName)

      if (categoryIndex !== -1) {
        selectedCategoryIndex.value = categoryIndex
      } else {
        selectedCategoryIndex.value = null // 如果未找到匹配，隐藏列表
      }
    })
  }
})



</script>

<style scoped>
.map-container {
  position: absolute;
  top: 1%; 
  left: 20%; 
  bottom: 1.5%; 
  width: 50%; 
  overflow: visible; 
  flex-direction: column;
  gap: 15px;
  z-index: 1000;
}

/* 右侧各个组件的样式 */
.component-header {
  display: flex;
  align-items: center;
  margin-bottom: 10px;
}

.mars2d-container {
  width: 100%;
  height: 94.25%;
  border: 0px solid #add8e6; 
  border-radius: 10px;
  margin-top: 30px; /* 设置与 header 元素的距离为 20px */
}


/* 右侧各个组件的样式 */
.side-panel {
  position: absolute;
  top: 1.5%; 
  right: 1.5%; 
  bottom: 1.5%; 
  width: calc(30% - 3%); 
  display: flex;
  flex-direction: column;
  gap: 15px;
  z-index: 1000;
  pointer-events: auto;
}



.coordinate-list,
.building-info,
.gpt4-chatbox {
  background-color: #ffffff;
  padding: 15px; /* 增加一点填充 */
  border-radius: 10px; /* 与地图容器保持一致 */
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  pointer-events: auto;
  flex: 1;
  overflow-y: auto;
  border: 2px solid #add8e6; /* 与地图容器的边框颜色一致 */
}

.building-info {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  font-size: 1.2em;
}

.building-info h3 {
  margin-bottom: 10px;
}

.building-info p {
  margin: 0;
}

.coordinate-list {
  position: absolute;
  top: 50px;
  right: 5%;
  width: 250px;
  max-height: 300px; /* 限制最大高度 */
  background-color: #fff;
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 10px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  overflow-y: auto; /* 添加垂直滚动条 */
}

.coordinate-list ul {
  list-style-type: none;
  padding-left: 10px;
}

.coordinate-list ul li {
  cursor: pointer;
  padding: 5px;
  border-radius: 8px;
  transition: background-color 0.3s ease, box-shadow 0.3s ease;
}

.coordinate-list ul li.highlighted {
  border: 2px solid blue;
}

.coordinate-list ul li:hover {
  background-color: #f0f8ff;
  border: 2px solid blue;
}

.gpt4-chatbox {
  display: flex;
  flex-direction: column;
}

.chat-content {
  flex: 1;
  overflow-y: auto;
  margin-bottom: 10px;
}
.chat-content p {
  padding: 10px;
  margin: 5px 0;
  border-radius: 8px;
  background-color: #bdd0e2;
  border: 1px solid #add8e6;
}

.chat-content p.user-message {
  background-color: #e0ffe0;
  border: 1px solid #90ee90;
}

.input-container {
  display: flex;
  align-items: center;
}

textarea {
  flex: 1;
  padding: 8px;
  border-radius: 4px;
  border: 2px solid #add8e6; /* 默认边框颜色 */
  outline: none; /* 移除默认的点击高亮 */
}

textarea:focus {
  border-color: #0561c4; /* 深蓝色边框 */
  box-shadow: 0 0 5px rgba(0, 86, 179, 0.5); /* 可选的蓝色阴影效果 */
}

button {
  background-color: #64a4e9;
  color: #fff;
  border: none;
  padding: 8px;
  border-radius: 4px;
  cursor: pointer;
  margin-left: 10px;
}

button svg {
  vertical-align: middle;
}

button:hover {
  background-color: #1f6abb;
}

.modal {
  position: absolute;
  top: 0;
  right: 0;
  width: 30%;
  height: 100%;
  background-color: #ffffff;
  padding: 20px;
  box-shadow: -2px 0 8px rgba(0, 0, 0, 0.15);
  z-index: 2000;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  align-items: center;
  border-radius: 8px;
  border: 1px solid #0c0c0c;
}

.description-container {
  position: absolute;
  top: 0; /* 改为 0，贴合顶部 */
  left: 0; /* 改为 0，贴合左侧 */
  bottom: 0; /* 改为 0，贴合底部 */
  width: 17%; /* 占据左侧 16% 的宽度 */
  overflow: hidden;
  background-color: #e6edf0; /* 修改为淡蓝色 */
  padding: 15px; /* 添加内边距 */
}

.arrow {
  width: 0;
  height: 0;
  border-left: 6px solid transparent;
  border-right: 6px solid transparent;
  border-top: 8px solid black; /* 黑色实心箭头 */
  margin-right: 5px; /* 箭头与文字之间的间距 */
}

.component-header span {
  font-weight: bold;
}

.LatitudeandLongitude {
  font-size: 12px; /* 设置较小的字体大小 */
  font-family: 'Noto Sans SC', sans-serif; /* 设置字体 */
}

.description-box {
  background-color: #5592cf; /* 设置深蓝色背景 */
  color: white; /* 文字颜色设置为白色（可选）以确保对比度 */
  padding: 18px; /* 添加一些内边距让文本不贴边 */
  margin: 30px 0 0 -25px; /* 负的左边和右边边距，正的 margin-top 控制下移 */
  width: 103%; /* 确保描述部分占据容器的全部宽度 */
  font-family: 'Noto Sans SC', sans-serif; /* 设置字体 */
}

.image-display {
  position: absolute;
  top: 80%;    /* 垂直居中 */
  left: 50%;   /* 水平居中 */
  transform: translate(-50%, -50%); /* 移动到中心位置 */
  width: 300px;  /* 放大图片容器宽度 */
  height: 300px; /* 放大图片容器高度 */
  border: 1px solid #ddd;
  overflow: hidden;
}


.image-display::before {
  content: '暂无'; /* 图片加载失败时显示的文字 */
  display: block;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: #999;
  font-size: 14px;
  text-align: center;
  visibility: hidden; /* 默认隐藏提示文字 */
}

.image-display[error]::before {
  visibility: visible; /* 加载失败时显示提示文字 */
}

.building-image {
  width: 100%;
  height: 100%;
  object-fit: cover; /* 确保图片覆盖整个矩形区域 */
}


@font-face {
  font-family: 'oldfont';
  src: url('E:\项目\GIS\mars2d-vue-template-master\mars2d-vue3-vite\src\assets\fonts\oldfont.ttf') format('truetype'); /* 指定字体文件的路径 */
}

.oldfont {
  font-family: 'oldfont', sans-serif; /* 使用本地字体，替换 YourLocalFont 为实际的字体名称 */
  font-size: 35px; /* 可根据需要调整字体大小 */
  font-weight: bold; /* 设置字体粗细（可选） */
}

.label-icon {
  width: 20px; /* 设置图标的宽度 */
  height: 20px; /* 设置图标的高度 */
  margin-right: 8px; /* 图标与文本之间的间距 */
  vertical-align: middle; /* 保持图标与文本垂直居中对齐 */
}

.chart-container {
  width: 700px;
  height: 350px;
  position: relative; /* 保持相对布局 */
  z-index: 1000; /* 设置较高的层级，确保在side-panel前面显示 */
}

</style>
